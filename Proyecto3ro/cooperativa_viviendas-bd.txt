CREATE DATABASE IF NOT EXISTS cooperativa_viviendas 
CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;
USE cooperativa_viviendas;

CREATE TABLE IF NOT EXISTS usuario (
 	id_usuario INT AUTO_INCREMENT PRIMARY KEY,
 	id_persona VARCHAR(20) NOT NULL UNIQUE,
 	usuario_login VARCHAR(30) NOT NULL UNIQUE,
 	nombre VARCHAR(50) NOT NULL,
 	apellido VARCHAR(50) NOT NULL,
 	email_cont VARCHAR(100) UNIQUE,
 	telefono_cont VARCHAR(20),
 	rol ENUM('administrador','cooperativista') NOT NULL DEFAULT 'cooperativista',
 	contrasena VARCHAR(255) NOT NULL -- password_hash() 
) ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS vivienda (
 	id_vivienda INT AUTO_INCREMENT PRIMARY KEY,
 	estado ENUM('Planificación','Construcción','Terminada','Asignada') NOT NULL,
 	calle VARCHAR(50),
 	nro_puerta VARCHAR(8),
	nro_apt VARCHAR(8) 
) ENGINE=InnoDB; 

CREATE TABLE IF NOT EXISTS pago ( 
	id_pago INT AUTO_INCREMENT PRIMARY KEY,
 	tipo_pago ENUM('mensual','inicial','compensatorio') NOT NULL,
 	monto DECIMAL(10,2) NOT NULL,
 	fecha DATE NOT NULL,
	id_usuario INT NOT NULL,
	estado ENUM('solicitado', 'aprobado') not null default solicitado,
	CONSTRAINT fk_pago_usuario FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario) 
	ON DELETE CASCADE ON UPDATE CASCADE 
) ENGINE=InnoDB; 

CREATE TABLE IF NOT EXISTS trabajo ( 
	id_registro INT AUTO_INCREMENT PRIMARY KEY, 
	semana INT, 
	horas_cumplidas DECIMAL(5,2), 
	fch_registro DATE NOT NULL, 
	id_usuario INT NOT NULL, 
	motivo VARCHAR(255) NULL,
	CONSTRAINT fk_trabajo_usuario FOREIGN KEY (id_usuario) REFERENCES usuario(id_usuario) 
ON DELETE CASCADE ON UPDATE CASCADE 
) ENGINE=InnoDB;